---
layout: post
title: "HM源码分析之帧内编码（一）：帧内编码的原理"
date: 2015-09-07 20:42:26 -0700
comments: true
categories: HM源码分析
---

* list element with functor item
{:toc}

预测编码(Prediction Coding)是指利用已编码的一个或几个样本值，根据某种模型或方法，对
当前的样本值进行预测，并对样本真实值和预测值之间的差值进行编码。

<!--more-->

## 预测编码的原理

视频预测编码的主要思想是通过预测来消除像素间的相关性。根据参考像素位置的不同，视频
预测编码技术主要分为两大类：  

* 帧内预测，即利用当前图像内已编码像素生成预测值；  
* 帧间预测，即利用当前图像之前已编码图像的重建像素生成预测值。  

预测编码的基本过程如下图所示：   

对于当前输入像素值 x(n), 首先，利用已编码像素的重建值得到当前像素的预测值 p(n).
然后对二者的差值 e(n) 进行量化、熵编码，同时利用量化后的残差 e'(n) 与预测值 p(n) 得到
当前像素的重建值 x'(n), 用于预测之后待编码的像素。  

对应的解码过程如右图所示，经过熵解码可得到当前像素预测误差的重建值 e'(n), 将其与预测值
p(n) 想家即可得到当前像素的重建值 x'(n)。   

{% img /images/HM/prediction_coding.png %}

## 帧内预测的模式

HEVC 亮度分量帧内预测支持 5 种大小的 PU: 4x4/8x8/16x16/32x32/64x64，其中每一种大小
的 PU 都对应 35 种预测模式，包括 Planar 模式、DC 模式以及 33 种角度模式。所有预测模式
都使用相同模板。如图。

{% img /images/HM/hevc_prediction_model.png %}

表：帧内预测 35 种模式编号  

| 帧内模式编号 | 帧内模式名称 |
| :---: | :---: |
| 0 | Planar 模式 |
| 1 | DC 模式 |
| 2~34 | 33 种角度模式 |

Planar 模式适用于像素值缓慢变化的区域，它使用水平和垂直方向的两个线性滤波器，并将二者
的平均值作为当前块像素的预测值。DC 模式适用于大面积平坦区域，当前块预测值可由其左侧和上方
参考像素的平均值得到。角度模式主要用于视频内容中不同方向的纹理。  

### 亮度模式的编码

### 色度模式的编码

## 帧内预测的过程

HEVC 中，35 种预测模式是在 PU 的基础上定义的，而具体帧内预测过程的实现则是以 TU 为单位的。
标准规定 PU 可以以四叉树的形式划分 TU，且一个 PU 内的所有 TU 共享同一种预测模式。HEVC 帧内预测可分为以下 3 个步骤：  

* 判断当前 TU 相邻参考像素是否可用并做相对应的处理  
* 对参考像素进行滤波  
* 根据滤波后的参考像素计算当前 TU 的预测像素值  

### 相邻参考像素的获取

### 参考像素的滤波

### 预测像素的计算




