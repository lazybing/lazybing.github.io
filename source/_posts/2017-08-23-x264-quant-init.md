---
layout: post
title: "X264源码解析之x264_quant_init函数"
date: 2017-08-23 08:43:19 -0700
comments: true
categories: x264
---

* list element with functor item
{:toc}

本文主要记录 X264 中使用到的量化。该函数主要对`x264_quant_functions_t`结构体中的函数指针进行赋值，

<!--more-->

首先看其中的一个例子`quant_8x8`函数，它的定义位于`common/quant.c`中，定义如下：  

{% codeblock lang:c %}
static int quant_8x8( dctcoef dct[64], udctcoef mf[64], udctcoef bias[64] )
{
    int nz = 0;
    for( int i = 0; i < 64; i++ )
        QUANT_ONE( dct[i], mf[i], bias[i] );
    return !!nz;
}
{% endcodeblock %}

其中`QUANT_ONE`定义如下：  

{% codeblock lang:c %}
#define QUANT_ONE( coef, mf, f ) \
{ \
    if( (coef) > 0 ) \
        (coef) = (f + (coef)) * (mf) >> 16; \
    else \
        (coef) = - ((f - (coef)) * (mf) >> 16); \
    nz |= (coef); \
}
{% endcodeblock %}


